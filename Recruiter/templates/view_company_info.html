{% extends 'dashboard/content.html' %}
{% block content %}
    {% if request.user.get_user_type_display == 'Interviewer' %}
        {% with active_menu="recruiter" active_tab="view_company_info" %}
            {{ block.super }}
        {% endwith %}
    {% else %}
        {% with active_menu="interview" active_tab="manage_companies" active_page="view_company_info" %}
            {{ block.super }}
        {% endwith %}
    {% endif %}
{% endblock %}
{% block rightPanel %}
    <div class="container-fluid p-2">
        <div class="row mb-3">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header fw-bold fs-4">
                        <span class="me-2"><i class="bi bi-building"></i> </span><span> {{ company.name }}</span>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-sm-10">
                                <table class="table table-striped table-responsive">
                                    <tr>
                                        <td><b>Full Name</b></td>
                                        <td>{{ company.full_name }}</td>
                                    </tr>
                                    <tr>
                                        <td><b>WebSite</b></td>
                                        <td><a target="_blank"
                                               href="{{ company.website }}">{{ company.website }}</a></td>
                                    </tr>
                                    <tr>
                                        <td><b>Type</b></td>
                                        <td>{{ company.get_type_display }}</td>
                                    </tr>
                                    {% if company.description %}
                                        <tr>
                                            <td><b>Description</b></td>
                                            <td>{{ company.description }}</td>
                                        </tr>
                                    {% endif %}
                                </table>
                            </div>
                            <div class="col-sm-2">
                                <img class="img-thumbnail zoom" height="100%" width="100%"
                                     src="{{ MEDIA_ROOT }}{{ company.get_company_logo }}" alt=""/>
                            </div>
                        </div>
                        <hr/>
                        <div class="row mb-3">
                            <div class="table-container">
                                <table class="table table-striped table-responsive caption-top">
                                    <caption class="fw-bold">
                                        <span class="me-4"> Criteria </span>
                                        {% if perms.Company.can_update_company_details %}
                                            <span style="float: right">
                                            <a class="btn btn-success" href="{% url 'add_role' company.pk %}">
                                                <span class="me-2"><i class="bi bi-plus-circle"></i></span>
                                                <span>Add Criteria</span>
                                            </a>
                                        </span>
                                        {% endif %}
                                    </caption>
                                    <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Criteria Name</th>
                                        <th>Batch</th>
                                        <th>CGPA</th>
                                        <th>Maximum Existing Backlogs</th>
                                        <th>Maximum Backlog History</th>
                                        <th>10th %</th>
                                        <th>12th %</th>
                                        {% if perms.Company.can_update_company_details %}
                                            <th></th>
                                            <th></th>
                                        {% endif %}
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for criteria in company.criteria_set.all %}
                                        <tr>
                                            <td>{{ forloop.counter }}</td>
                                            <td style="font-style: italic;color: #bb2d3b"><b>{{ criteria.name }}</b>
                                            </td>
                                            <td>
                                                <ul style="list-style: none">
                                                    {% for batch in criteria.get_allowed_batches %}
                                                        <li>{{ batch }}</li>
                                                    {% endfor %}
                                                </ul>
                                            </td>
                                            <td>{{ criteria.get_required_cgpa|default_if_none:"" }}</td>
                                            <td>{{ criteria.history | default_if_none:"" }}</td>
                                            <td>{{ criteria.current | default_if_none:"" }}</td>
                                            <td>{{ criteria.get_required_10th_percentage|default_if_none:"" }}</td>
                                            <td>{{ criteria.get_required_12th_percentage|default_if_none:"" }}</td>
                                            {% if perms.Company.can_update_company_details %}
                                                <td>
                                                    <a class="btn btn-outline-secondary" target="_blank"
                                                       href="{% url 'edit_criteria' company.pk criteria.pk %}"><i
                                                            class="bi bi-pencil"></i></a>
                                                </td>
                                                <td>
                                                    <a class="btn btn-danger" target="_blank"
                                                       href="{% url 'delete_criteria' company.pk criteria.pk %}"><i
                                                            class="bi bi-trash"></i></a>
                                                </td>
                                            {% endif %}
                                        </tr>

                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <hr/>
                        <div class="row mb-3">
                            <div class="table-container">
                                <table class="table table-responsive table-striped caption-top">
                                    <caption class="fw-bold">
                                        <span class="me-4"> Job Roles Information </span>
                                        {% if perms.Company.can_update_company_details %}
                                            <span style="float: right">
                                            <a class="btn btn-success" target="_blank"
                                               href="{% url 'add_role' company.pk %}">
                                                <span class="me-2"><i class="bi bi-plus-circle"></i></span>
                                                <span>Add Role</span>
                                            </a>
                                        </span>
                                        {% endif %}
                                    </caption>
                                    <thead>
                                    <th>#</th>
                                    <th>Role</th>
                                    <th>Package</th>
                                    <th>Vacancy</th>
                                    <th>Type</th>
                                    <th>Criteria</th>
                                    <th>Description</th>
                                    <th>Bond Info</th>
                                    <th>Additional Info</th>
                                    {% if perms.Company.can_update_company_details %}
                                        <th></th>
                                        <th></th>
                                    {% endif %}
                                    </thead>
                                    {% for job in company.companyjob_set.all %}
                                        <tr>
                                            <td>{{ forloop.counter }}</td>
                                            <td>{{ job.role_name }}</td>
                                            <td>{{ job.package }}</td>
                                            <td>{{ role.vacancy| default_if_none:"" }}</td>
                                            <td>{{ job.get_type_display }}</td>
                                            <td>{{ job.criteria }}</td>
                                            <td>{{ job.salary_description | default_if_none:"" }}</td>
                                            <td>{{ job.bond_description | default_if_none:"" }}</td>
                                            <td>
                                                {% if job.documents %}
                                                    {% load static %}
                                                    <a target="_blank"
                                                       href="/media/{{ job.documents }}">View</a>
                                                {% endif %}
                                            </td>
                                            {% if perms.Company.can_update_company_details %}
                                                <td>
                                                    <a class="btn btn-outline-secondary" target="_blank"
                                                       href="{% url 'edit_role' company.pk job.pk %}"><i
                                                            class="bi bi-pencil"></i></a>
                                                </td>
                                                <td>
                                                    <a class="btn btn-danger" target="_blank"
                                                       href="{% url 'delete_role' company.pk job.pk %}"><i
                                                            class="bi bi-trash"></i></a>
                                                </td>
                                            {% endif %}
                                        </tr>
                                    {% endfor %}
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}